let lastX,lastY,canvas,canvasCtx,prevImageData,mousePressed=!1,brushColor="#000",brushSize=5;function initApp(){canvas=document.getElementById("myCanvas"),canvasCtx=canvas.getContext("2d"),canvasResize(),window.onresize=canvasResize,canvas.addEventListener("mousedown",(function(e){mousePressed=!0,draw(e.pageX-$(this).offset().left,e.pageY-$(this).offset().top,!1,!0)})),canvas.addEventListener("mousemove",(function(e){mousePressed&&draw(e.pageX-$(this).offset().left,e.pageY-$(this).offset().top,!0,!0)})),canvas.addEventListener("mouseup",(function(e){mousePressed=!1})),canvas.addEventListener("mouseleave",(function(e){mousePressed=!1})),canvas.addEventListener("touchstart",(function(e){mousePressed=!0;let t=e.touches[0],n=new MouseEvent("mousedown",{clientX:t.clientX,clientY:t.clientY});canvas.dispatchEvent(n)})),canvas.addEventListener("touchmove",(function(e){let t=e.touches[0],n=new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY});canvas.dispatchEvent(n)})),canvas.addEventListener("touchend",(function(e){mousePressed=!1}),!1),canvas.addEventListener("touchcancel",(function(e){mousePressed=!1}),!1);let e=document.getElementById("clearBtn");e.addEventListener("click",clearArea),e.addEventListener("mouseover",e=>{document.getElementById("my-clear-icon").classList.toggle("spin")}),e.addEventListener("mouseout",e=>{document.getElementById("my-clear-icon").classList.toggle("spin")});let t=document.getElementById("saveBtn");t.addEventListener("mouseover",e=>{document.getElementById("my-save-icon").classList.toggle("slide-down")}),t.addEventListener("mouseout",e=>{document.getElementById("my-save-icon").classList.toggle("slide-down")}),t.addEventListener("blur",e=>{document.getElementById("my-save-icon").classList.toggle("slide-down")}),t.addEventListener("click",(function(e){t.href=canvas.toDataURL("image/png"),t.download="image.png"}),!1),document.getElementById("sliderRange").addEventListener("change",e=>{document.getElementById("brushSize").innerHTML=e.target.value})}function draw(e,t,n,s=!1){n&&(canvasCtx.strokeStyle=brushColor,canvasCtx.lineWidth=$("#sliderRange").val(),canvasCtx.lineJoin="round",!1===s?(canvasCtx.beginPath(),canvasCtx.moveTo(lastX,lastY),canvasCtx.lineTo(e,t),canvasCtx.closePath(),canvasCtx.stroke()):(canvasCtx.beginPath(),canvasCtx.arc(e,t,40,0,2*Math.PI),canvasCtx.stroke(),prevImageData=canvasCtx.getImageData(50,50,500,500))),lastX=e,lastY=t}function setDisplays(){document.getElementById("appVersion").style="display: block;";let e=document.getElementById("mousePos");e.style="display: block;",e.innerHTML="brush position:\n0 / 0";let t=document.getElementById("viewport");t.style="display: block;",t.innerHTML="viewport:\n"+window.innerHeight+"px / "+window.innerWidth+"px",window.addEventListener("touchmove",t=>{let n="brush position:\n"+(t.touches[0].pageX+"").substr(0,7)+" / "+(t.touches[0].pageY+"").substr(0,7);e.innerHTML=n}),window.addEventListener("mousemove",t=>{let n="brush position:\n"+t.pageX+" / "+t.pageY;e.innerHTML=n})}function canvasResize(){window.screen.width<=600?(canvas.width=window.innerWidth,canvas.height=.65*window.innerHeight):(canvas.width=window.innerWidth,canvas.height=window.innerHeight/1.2),document.getElementById("viewport").innerHTML="viewport:\n"+window.innerHeight+"px / "+window.innerWidth+"px"}function canvasAddEvents(){}function clearArea(){canvasCtx.setTransform(1,0,0,1,0,0),canvasCtx.clearRect(0,0,canvasCtx.canvas.width,canvasCtx.canvas.height),canvasCtx.putImageData(prevImageData,0,0)}function pickColor(e,t){brushColor=e;let n=document.getElementsByClassName("color");$.each(n,(e,n)=>{n.id===t.id?document.getElementById(n.id).classList.add("color--picked"):document.getElementById(n.id).classList.remove("color--picked")})}